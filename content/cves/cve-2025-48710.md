---
title: "Kubernetes CRD Abstraction Risks in kro"
date: 2025-06-04T00:00:00Z
cve_id: "CVE-2025-48710"
severity: "Medium"
summary: "Confused deputy vulnerability in kro (Kube Resource Orchestrator) allowing attackers to introduce malicious CustomResourceDefinitions (CRDs) leading to remote code execution."
nvd_embed_url: "https://nvd.nist.gov/vuln/detail/CVE-2025-48710"
tags: ["kubernetes", "crd", "kro", "confused-deputy", "rce"]
---

## Discovery Timeline

The vulnerability was discovered by Roi Nisimi from the Orca Security Research Pod during a security audit of kro, an experimental open-source project maintained by AWS, Google Cloud, and Azure.

## Vulnerability Details

### Root Cause Analysis

The vulnerability exists in kro's handling of CustomResourceDefinitions (CRDs) and its dynamic controller system. Two main issues were identified:

1. **CRD Modification**: kro doesn't actively watch for CRD modifications, and auto-scheduled reconciliation only occurs every 10 hours by default. This allows attackers to directly modify CRDs without triggering immediate validation.

2. **Informer Crash Loop**: When a ResourceGraphDefinition (RGD) is deleted, its associated dynamic informer enters a watch error crash loop and doesn't properly shut down. The informers never shut down on watch errors but gradually increase retry intervals.

### Attack Vector

An attacker with cluster-wide permissions over CRDs can:

1. Modify existing CRDs managed by kro
2. Introduce new malicious CRDs that affect kro's reconciliation process
3. Take advantage of the informer crash loop to maintain persistence

Example of a legitimate RGD that could be modified:

```yaml
apiVersion: kro.run/v1alpha1
kind: ResourceGraphDefinition
metadata:
  name: my-nginx-app-rgd
spec:
  schema:
    apiVersion: v1alpha1
    kind: MyNginxApp
    spec:
      name: string | default="my-nginx-app"
      image: string | default="nginx"

  resources:
    - id: deployment
      template:
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          name: ${schema.spec.name}
        spec:
          replicas: 3
          selector:
            matchLabels:
              app: ${schema.spec.name}
          template:
            metadata:
              labels:
                app: ${schema.spec.name}
            spec:
              containers:
                - name: ${schema.spec.name}
                  image: ${schema.spec.image}
                  ports:
                    - containerPort: 80
```

## Technical Impact

### Exploitation Scenario

1. **Initial Access**: Attacker gains permissions to modify CRDs
2. **CRD Modification**: Attacker modifies existing CRD or introduces a new malicious one
3. **Controller Confusion**: kro's controller is confused into deploying malicious resources
4. **Code Execution**: Attacker achieves remote code execution by replacing container images

### Proof of Concept

The researchers demonstrated successful exploitation by:
1. Modifying a CRD to replace a legitimate container image with a reverse shell
2. Achieving remote code execution within the cluster
3. Maintaining persistence through the informer crash loop bug

## Affected Versions

- All alpha versions of kro prior to the security patch
- The issue was fixed in the latest release: https://github.com/kro-run/kro/release

## Detection Methods

### Kubernetes Audit Logs

Monitor for suspicious CRD modifications:

```bash
kubectl get events --field-selector type=Warning \
  --all-namespaces | grep -i "customresourcedefinition"

# Check for modifications to kro-managed CRDs
kubectl get events --field-selector involvedObject.kind=CustomResourceDefinition \
  --all-namespaces | grep -i "kro.run"
```

### Resource Monitoring

```bash
# List all kro-managed CRDs
kubectl get crd -l kro.run/managed=true

# Monitor for changes to these CRDs
kubectl get crd -l kro.run/managed=true -w
```

## Mitigation Strategies

### Immediate Actions

1. Update to the latest version of kro
2. Review and restrict CRD permissions
3. Implement strict RBAC policies for kro-related resources

### Long-term Solutions

```yaml
# Example RBAC configuration to restrict CRD access
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: restricted-kro-access
rules:
- apiGroups: ["apiextensions.k8s.io"]
  resources: ["customresourcedefinitions"]
  verbs: ["get", "list", "watch"]
  resourceNames: ["resourcegraphdefinitions.kro.run"]
```

### Monitoring and Alerting

Set up alerts for:
1. CRD modifications outside normal deployment windows
2. Unusual patterns in kro controller logs
3. Unexpected changes to kro-managed resources

## Vendor Response

### Timeline

- **May 2025**: Initial discovery by Orca Security Research Pod
- **May 2025**: Reported to kro maintainers
- **May 2025**: Fix developed and released
- **May 13, 2025**: Public disclosure

### Patches Applied

The maintainers implemented several fixes:
1. Added active monitoring of CRD modifications
2. Fixed the informer crash loop issue
3. Improved shutdown handling for dynamic controllers

## Lessons Learned

This vulnerability highlights several important security considerations:

1. **Privilege Management**: Carefully consider the implications of granting cluster-wide permissions
2. **Controller Design**: Dynamic controllers require robust error handling and lifecycle management
3. **Resource Validation**: Implement continuous validation of critical resources
4. **Release Management**: Ensure security fixes are promptly included in releases

## Conclusion

CVE-2025-48710 demonstrates the potential risks in Kubernetes extension mechanisms, particularly when dealing with dynamic CRD controllers. While kro is an experimental project not intended for production use, this vulnerability serves as a valuable lesson for similar tools and highlights the importance of careful permission management in Kubernetes environments. 